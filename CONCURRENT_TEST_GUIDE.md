# OpenRouter å¹¶å‘æµ‹è¯•æŒ‡å—

æœ¬æŒ‡å—ä»‹ç»å¦‚ä½•ä½¿ç”¨æ–°åˆ›å»ºçš„å¹¶å‘æµ‹è¯•å·¥å…·æ¥æµ‹è¯•OpenRouter APIçš„å¤šæ¨¡å‹å¹¶å‘èƒ½åŠ›å’Œè´Ÿè½½å‡è¡¡ç‰¹æ€§ã€‚

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

æˆ‘ä»¬åˆ›å»ºäº†ä¸€å¥—å®Œæ•´çš„æµ‹è¯•å·¥å…·ï¼ŒåŒ…æ‹¬ï¼š

1. **ConcurrentTestService** - æ ¸å¿ƒæµ‹è¯•æœåŠ¡
2. **ConcurrentTestPanel** - å¯è§†åŒ–æµ‹è¯•é¢æ¿
3. **TestRunner** - è‡ªåŠ¨åŒ–æµ‹è¯•è¿è¡Œå™¨
4. **æµ‹è¯•ç”¨ä¾‹** - é¢„å®šä¹‰çš„æµ‹è¯•åœºæ™¯

## ğŸš€ å¦‚ä½•ä½¿ç”¨

### æ–¹æ³•1: ä½¿ç”¨å¯è§†åŒ–ç•Œé¢

1. å¯åŠ¨åº”ç”¨åï¼Œç‚¹å‡»é¡¶éƒ¨æ ‡ç­¾åˆ‡æ¢åˆ°"å¹¶å‘æµ‹è¯•"é¢æ¿
2. åœ¨æµ‹è¯•é¢æ¿ä¸­é…ç½®ï¼š
   - é€‰æ‹©è¦æµ‹è¯•çš„æ¨¡å‹ï¼ˆå¯å¤šé€‰ï¼‰
   - è®¾ç½®æµ‹è¯•æç¤ºè¯
   - è°ƒæ•´å¹¶å‘æ•°å’Œè¿­ä»£æ¬¡æ•°
3. ç‚¹å‡»"è¿è¡Œå¹¶å‘æµ‹è¯•"æˆ–"è¿è¡Œè´Ÿè½½æµ‹è¯•"
4. æŸ¥çœ‹å®æ—¶ç»“æœå’Œæ€§èƒ½æŒ‡æ ‡

### æ–¹æ³•2: ä½¿ç”¨æµ‹è¯•è¿è¡Œå™¨

```typescript
import { globalTestRunner } from './src/utils/testRunner';

// è¿è¡Œæ‰€æœ‰æµ‹è¯•
const reports = await globalTestRunner.runAllTests();

// è¿è¡Œç‰¹å®šæµ‹è¯•
const singleReport = await globalTestRunner.runTest('å•æ¨¡å‹åŸºç¡€æµ‹è¯•');

// ç”ŸæˆæŠ¥å‘Š
const htmlReport = globalTestRunner.generateHTMLReport(reports);
```

### æ–¹æ³•3: ç›´æ¥è°ƒç”¨æœåŠ¡

```typescript
import { ConcurrentTestService } from './src/services/concurrentTestService';

const testService = ConcurrentTestService.getInstance();

// å¹¶å‘æµ‹è¯•å¤šä¸ªæ¨¡å‹
const results = await testService.testModelsConcurrently(
  ['æµ‹è¯•æç¤ºè¯1', 'æµ‹è¯•æç¤ºè¯2'],
  ['google/gemini-2.5-flash', 'deepseek/deepseek-chat-v3-0324'],
  3 // æœ€å¤§å¹¶å‘æ•°
);

// è´Ÿè½½æµ‹è¯•
const loadResult = await testService.runLoadTest({
  maxConcurrency: 5,
  timeout: 15000,
  prompts: ['æµ‹è¯•æç¤º'],
  models: ['google/gemini-2.5-flash']
});
```

## ğŸ“Š æµ‹è¯•åœºæ™¯

### 1. å•æ¨¡å‹åŸºç¡€æµ‹è¯•
- **ç›®çš„**: æµ‹è¯•å•ä¸ªæ¨¡å‹çš„åŸºæœ¬å“åº”èƒ½åŠ›
- **é…ç½®**: 1ä¸ªæ¨¡å‹ï¼Œ3æ¬¡è¿­ä»£ï¼Œä½å¹¶å‘
- **é¢„æœŸ**: æˆåŠŸç‡â‰¥90%ï¼Œå»¶è¿Ÿâ‰¤3ç§’

### 2. å¤šæ¨¡å‹å¹¶å‘æµ‹è¯•
- **ç›®çš„**: æµ‹è¯•å¤šä¸ªæ¨¡å‹åŒæ—¶å¤„ç†è¯·æ±‚çš„èƒ½åŠ›
- **é…ç½®**: 3ä¸ªæ¨¡å‹ï¼Œ5æ¬¡è¿­ä»£ï¼Œ3å¹¶å‘
- **é¢„æœŸ**: æˆåŠŸç‡â‰¥80%ï¼Œå»¶è¿Ÿâ‰¤5ç§’

### 3. é«˜å¹¶å‘å‹åŠ›æµ‹è¯•
- **ç›®çš„**: æµ‹è¯•ç³»ç»Ÿåœ¨é«˜å¹¶å‘ä¸‹çš„ç¨³å®šæ€§
- **é…ç½®**: 2ä¸ªæ¨¡å‹ï¼Œ10æ¬¡è¿­ä»£ï¼Œ5å¹¶å‘
- **é¢„æœŸ**: æˆåŠŸç‡â‰¥70%ï¼Œå»¶è¿Ÿâ‰¤8ç§’

### 4. è´Ÿè½½å‡è¡¡æµ‹è¯•
- **ç›®çš„**: æµ‹è¯•ä¸åŒæ¨¡å‹çš„è´Ÿè½½å‡è¡¡æ•ˆæœ
- **é…ç½®**: 4ä¸ªæ¨¡å‹ï¼Œ8æ¬¡è¿­ä»£ï¼Œ4å¹¶å‘
- **é¢„æœŸ**: æˆåŠŸç‡â‰¥75%ï¼Œå»¶è¿Ÿâ‰¤4ç§’

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

æµ‹è¯•å®Œæˆåï¼Œæ‚¨å°†è·å¾—ä»¥ä¸‹æŒ‡æ ‡ï¼š

- **æ€»è¯·æ±‚æ•°**: å‘é€çš„æ€»APIè¯·æ±‚æ•°é‡
- **æˆåŠŸè¯·æ±‚**: æˆåŠŸå®Œæˆçš„è¯·æ±‚æ•°é‡
- **å¤±è´¥è¯·æ±‚**: å¤±è´¥çš„è¯·æ±‚æ•°é‡
- **æˆåŠŸç‡**: æˆåŠŸè¯·æ±‚å æ€»è¯·æ±‚çš„æ¯”ä¾‹
- **å¹³å‡å»¶è¿Ÿ**: æ‰€æœ‰æˆåŠŸè¯·æ±‚çš„å¹³å‡å“åº”æ—¶é—´
- **æœ€å°/æœ€å¤§å»¶è¿Ÿ**: æœ€å¿«å’Œæœ€æ…¢çš„å“åº”æ—¶é—´
- **ååé‡**: æ¯ç§’å¤„ç†çš„è¯·æ±‚æ•°
- **æ¨¡å‹æ€§èƒ½**: æ¯ä¸ªæ¨¡å‹çš„è¯¦ç»†æ€§èƒ½æ•°æ®

## ğŸ” ç»“æœåˆ†æ

### æ­£å¸¸æŒ‡æ ‡å‚è€ƒ
- **æˆåŠŸç‡**: >80% ä¸ºè‰¯å¥½
- **å¹³å‡å»¶è¿Ÿ**: <5ç§’ ä¸ºå¯æ¥å—
- **ååé‡**: >0.5 req/s ä¸ºåˆç†

### å¸¸è§é—®é¢˜
- **é«˜å»¶è¿Ÿ**: å¯èƒ½æ˜¯ç½‘ç»œé—®é¢˜æˆ–æ¨¡å‹å“åº”æ…¢
- **å¤±è´¥ç‡é«˜**: å¯èƒ½æ˜¯APIé™åˆ¶æˆ–æ¨¡å‹æœåŠ¡å¼‚å¸¸
- **å¹¶å‘ç“¶é¢ˆ**: å¯èƒ½éœ€è¦è°ƒæ•´å¹¶å‘æ•°é™åˆ¶

## ğŸ› ï¸ æ•…éšœæ’é™¤

### æµ‹è¯•å¤±è´¥çš„å¤„ç†
1. **æ£€æŸ¥APIå¯†é’¥**: ç¡®ä¿OpenRouter APIå¯†é’¥æœ‰æ•ˆ
2. **ç½‘ç»œè¿æ¥**: éªŒè¯ç½‘ç»œè¿æ¥ç¨³å®šæ€§
3. **æ¨¡å‹å¯ç”¨æ€§**: ä½¿ç”¨å¥åº·æ£€æŸ¥åŠŸèƒ½ç¡®è®¤æ¨¡å‹çŠ¶æ€
4. **å¹¶å‘é™åˆ¶**: é€‚å½“é™ä½å¹¶å‘æ•°ä»¥é¿å…APIé™åˆ¶

### æ€§èƒ½ä¼˜åŒ–å»ºè®®
1. **é€‰æ‹©åˆé€‚çš„æ¨¡å‹**: æ ¹æ®éœ€æ±‚é€‰æ‹©å“åº”é€Ÿåº¦å¿«çš„æ¨¡å‹
2. **è°ƒæ•´å¹¶å‘æ•°**: æ‰¾åˆ°æœ€ä½³å¹¶å‘å¹³è¡¡ç‚¹
3. **è®¾ç½®åˆç†è¶…æ—¶**: é¿å…è¿‡é•¿ç­‰å¾…å½±å“æµ‹è¯•æ•ˆç‡

## ğŸ“ æ–‡ä»¶ç»“æ„

```
src/
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ concurrentTestService.ts      # æ ¸å¿ƒæµ‹è¯•æœåŠ¡
â”‚   â””â”€â”€ concurrentTestService.test.ts # å•å…ƒæµ‹è¯•
â”œâ”€â”€ components/
â”‚   â””â”€â”€ ConcurrentTestPanel.tsx       # å¯è§†åŒ–æµ‹è¯•é¢æ¿
â””â”€â”€ utils/
    â””â”€â”€ testRunner.ts                 # è‡ªåŠ¨åŒ–æµ‹è¯•è¿è¡Œå™¨
```

## ğŸ§ª è¿è¡Œæµ‹è¯•

### è¿è¡Œå•å…ƒæµ‹è¯•
```bash
npm test -- src/services/concurrentTestService.test.ts
```

### è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶
```bash
# åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€åº”ç”¨ï¼Œåˆ‡æ¢åˆ°"å¹¶å‘æµ‹è¯•"æ ‡ç­¾é¡µ
npm start
# ç„¶ååœ¨UIä¸­è¿è¡Œæµ‹è¯•
```

### ä½¿ç”¨æµ‹è¯•è¿è¡Œå™¨
```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
node -e "require('./src/utils/testRunner').globalTestRunner.runAllTests().then(console.log)"

# è¿è¡Œç‰¹å®šæµ‹è¯•
node -e "require('./src/utils/testRunner').globalTestRunner.runTest('å•æ¨¡å‹åŸºç¡€æµ‹è¯•').then(console.log)"
```

## ğŸ¯ å®é™…æµ‹è¯•ç¤ºä¾‹

### æµ‹è¯•OpenRouterè´Ÿè½½å‡è¡¡ç‰¹æ€§

```typescript
// æµ‹è¯•è½®è¯¢è´Ÿè½½å‡è¡¡
const results = await ConcurrentTestService.getInstance()
  .testRoundRobinLoadBalancing(
    'è¯·ç”¨ä¸€å¥è¯ä»‹ç»äººå·¥æ™ºèƒ½',
    ['google/gemini-2.5-flash', 'deepseek/deepseek-chat-v3-0324'],
    10
  );

// åˆ†æç»“æœ
const modelCounts = results.reduce((acc, r) => {
  acc[r.model] = (acc[r.model] || 0) + 1;
  return acc;
}, {});
console.log('è´Ÿè½½åˆ†å¸ƒ:', modelCounts);
```

### æµ‹è¯•å¹¶å‘æ€§èƒ½

```typescript
// é«˜å¹¶å‘æµ‹è¯•
const loadTest = {
  maxConcurrency: 5,
  timeout: 20000,
  prompts: Array(20).fill('æµ‹è¯•å¹¶å‘æ€§èƒ½'),
  models: ['google/gemini-2.5-flash']
};

const result = await ConcurrentTestService.getInstance().runLoadTest(loadTest);
console.log(`ååé‡: ${result.throughput} req/s`);
console.log(`å¹³å‡å»¶è¿Ÿ: ${result.averageLatency}ms`);
```

## ğŸ“‹ æµ‹è¯•æŠ¥å‘Š

æµ‹è¯•å®Œæˆåï¼Œæ‚¨å¯ä»¥é€‰æ‹©ä»¥ä¸‹æ ¼å¼å¯¼å‡ºç»“æœï¼š
- **HTMLæŠ¥å‘Š**: å¯è§†åŒ–å±•ç¤ºï¼Œé€‚åˆåˆ†äº«
- **CSVæ•°æ®**: ä¾¿äºè¿›ä¸€æ­¥åˆ†æ
- **JSONæ ¼å¼**: ç¨‹åºåŒ–ä½¿ç”¨

## ğŸ”„ æŒç»­é›†æˆ

å¯ä»¥å°†è¿™äº›æµ‹è¯•é›†æˆåˆ°CI/CDæµç¨‹ä¸­ï¼Œå®šæœŸæ£€æŸ¥APIæ€§èƒ½å’Œå¯ç”¨æ€§ã€‚

è¿™å¥—æµ‹è¯•å·¥å…·å°†å¸®åŠ©æ‚¨å…¨é¢äº†è§£OpenRouter APIçš„å¹¶å‘æ€§èƒ½å’Œè´Ÿè½½å‡è¡¡ç‰¹æ€§ï¼Œä¸ºç”Ÿäº§ç¯å¢ƒçš„ä½¿ç”¨æä¾›å¯é çš„æ•°æ®æ”¯æŒã€‚